---
title: "eda"
author: "Albert Sun"
date: "11/30/2020"
output: pdf_document
---
```{r}
library(tidyverse)
library(skimr)
library(here)
```

```{r}
durham <- read_csv(here("../data.csv")) %>% 
  filter(COUNTY == 630)
```

```{r}
durham <- durham %>% 
  select(sort(current_vars())) 
```


```{r}
skim(durham)
```

```{r}
ggplot(data = durham, aes(x = forcats::fct_infreq(race))) + 
  geom_bar(fill = "#23356D") + 
  labs(x = "Race",
       y = "Count",
       title = "Misdemeanor Convictions in Durham County by Race from 1994 to 2019",
       caption = "Dates: 1994-11-01 to 2019-02-04") + 
  scale_x_discrete(labels = c('Black','White','Hispanic','Other','American Indian','Unknown','Asian')) + 
  theme_minimal() 
```

# Misdemeanor Convictions by Gender

```{r}
ggplot(data = durham, aes(x = forcats::fct_infreq(gender))) + 
  geom_bar(fill = "#23356D") + 
  labs(x = "Gender",
       y = "Count",
       title = "Misdemeanor Convictions in Durham County by Gender from 1994 to 2019",
       caption = "Dates: 1994-11-01 to 2019-02-04") + 
  scale_x_discrete(labels = c('Male','Female')) + 
  theme_minimal()
```

# Misdemeanor Convictions by Types of Plea

```{r}
ggplot(data = durham, aes(x = forcats::fct_infreq(PLEA))) + 
  geom_bar(fill = "#23356D") + 
  labs(x = "Plea Type",
       y = "Count",
       title = "Types of Pleas in Durham County from 1994 to 2019",
       caption = "Dates: 1994-11-01 to 2019-02-04") + 
  scale_x_discrete(labels = c('Guilty','Guilty to lesser','Guilty Alford','No Contest','Not Guilty')) + 
  theme_minimal()
```

```{r}
durham %>%
  filter(sentsas > "2019-01-01") %>%
  ggplot(aes(x = forcats::fct_infreq(PLEA))) + 
  geom_bar(fill = "#23356D") + 
  labs(x = "Plea Type",
       y = "Count",
       title = "Types of Pleas in Durham County in 2019",
       caption = "Dates: 2019-01-01 to 2019-02-04") + 
  scale_x_discrete(labels = c('Guilty','Guilty to lesser','Guilty Alford','No Contest','Not Guilty')) + 
  theme_minimal()
```


# Convictions by type of offense (Person, Property, Drug, Public Order)


# Interaction between race and actual sentence

```{r}
#ggplot(durham, aes(x = race, y = ACTUAL)) + 
#  geom_boxplot()
```


# Top 5 misemeanor convictions by offense

# Age

```{r}
durham %>%
  ggplot(aes(x = age)) + 
  geom_histogram(binwidth = 1, fill = "#23356D") +
  labs(title = "Age of Individuals Convicted of Misdemeanors in Durham County",
       caption = "Dates: 1994-11-01 to 2019-02-04") + 
  labs(x = "Age",
       y = "Count") +
  theme_minimal()
```
```{r}
summarise(durham, mean_age = mean(age, na.rm = TRUE))
```

# Misdemeanor convictions over time (2018 - end)

```{r}
library(zoo)
```


```{r}
since2018 <- durham %>%
  filter(sentsas > "2018-06-01") %>%
  mutate(yrmn = as.factor(as.yearmon(sentsas))) %>%
  group_by(yrmn) %>%
  summarise(cnt = n()) %>%
  ggplot(aes(x = yrmn, y = cnt, group = 1)) +
  geom_line(stat = "identity", size = 1.5, color = "#23356D") +
  labs(x = "Month",
       y = "# Misdemeanor Convictions",
       title = "Total Monthly Misdemeanor Convictions") + 
  theme_minimal() + 
  theme(axis.text.x=element_text(angle = -90, hjust = 0), 
        axis.title.x=element_blank())

since2018
```

Add place showing where santana deberry is elected

Add images: https://stackoverflow.com/questions/9917049/inserting-an-image-to-ggplot2

# Misdemeanor convictions over time by type

```{r}
durham <- durham %>% 
  mutate(crimetype = as.factor(crimetype)) 

durham$crimetype <- factor(durham$crimetype, levels=c("1", "2", "3", "4"), labels=c("Person", "Property", "Drug (Non Trafficking)", "Other"))

durham %>%
  filter(sentsas > "2010-06-01") %>%
  mutate(yrmn = as.yearmon(sentsas)) %>%
  group_by(FY) %>%
  count(crimetype) %>%
  ungroup %>%
  mutate(crimetype = as.factor(crimetype)) %>%
  ggplot(aes(x = FY, y = n, group = crimetype)) + 
  geom_line() +
  geom_point(aes(shape = crimetype)) + 
  scale_color_manual(values = c("#23356D", "red", "green", "black")) +
  theme_minimal() + 
  theme(axis.text.x=element_text(angle = -90, hjust = 0))  +
  labs(shape='Crime Type',
       title = "Misdemeanor Convictions by Type of Offense") +
  theme(axis.title.x=element_blank(),
        axis.title.y=element_blank())
```

# fine imposed